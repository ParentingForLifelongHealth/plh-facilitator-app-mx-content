[{"flow_type":"template","flow_name":"profile","status":"released","rows":[{"type":"begin_template","name":"section_header","value":"section_header"},{"name":"section_id","value":"profile","exclude_from_translation":true},{"name":"section_data","value":"app_section"},{"type":"end_template"},{"type":"button","name":"button_language","value":"@global.language","action_list":"click | go_to: language_select","condition":"@global.has_multiple_languages","parameter_list":"style: card"},{"type":"begin_items","value":"@data.profile_section"},{"type":"button","name":"button_@item.id","value":"@item.title","action_list":"click | go_to: profile_@item.id","condition":"@item.show","parameter_list":"style: card"},{"type":"end_items"},{"type":"button","name":"button_package","value":"@global.your_package","action_list":"click | go_to: package_select","condition":"@global.has_multiple_content_packages","parameter_list":"style: card"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"profile_about","status":"released","rows":[{"type":"begin_template","name":"header","value":"section_header"},{"name":"section_id","value":"about","exclude_from_translation":true},{"name":"section_data","value":"profile_section"},{"type":"end_template"},{"type":"text","name":"text_user_name","value":"@global.user_name_question"},{"name":"user_name","value":"@fields.user_name"},{"type":"text_box","name":"text_box","value":"@local.user_name","condition":"@local.user_name != @global.user_name_default","parameter_list":"placeholder: @global.type_prompt"},{"type":"text_box","name":"text_box","condition":"@local.user_name == @global.user_name_default","parameter_list":"placeholder: @global.type_prompt"},{"type":"text","name":"text_state","value":"@global.state_question"},{"type":"combo_box","name":"user_state","value":"@fields.user_state","condition":"changed | set_field: user_state: @local.user_state","parameter_list":"answer_list: @data.state; placeholder: @global.select_prompt"},{"type":"begin_template","name":"nav_buttons","value":"nav_buttons","action_list":"completed | set_field: user_name:`@global.user_name_default`;\nuncompleted | set_field: user_name:`@global.user_name_default`;\ncompleted | set_field: user_state: @local.user_state;\nuncompleted | set_field: user_state: @local.user_state;\ncompleted | emit:completed;\nuncompleted | emit:uncompleted;","condition":"!@local.text_box"},{"type":"end_template"},{"type":"begin_template","name":"nav_buttons","value":"nav_buttons","action_list":"completed | set_field: user_name: @local.text_box;\nuncompleted | set_field: user_name: @local.text_box;\ncompleted | set_field: user_state: @local.user_state;\nuncompleted | set_field: user_state: @local.user_state;\ncompleted | emit:completed;\nuncompleted | emit:uncompleted;","condition":"@local.text_box"},{"type":"end_template"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"profile_id","status":"released","rows":[{"type":"begin_template","name":"header","value":"section_header"},{"name":"section_id","value":"id","exclude_from_translation":true},{"name":"section_data","value":"profile_section"},{"type":"end_template"},{"name":"user_id","value":"@fields._app_user_id","exclude_from_translation":true},{"name":"sync_latest","value":"@fields._server_sync_latest","exclude_from_translation":true},{"name":"sync_status","exclude_from_translation":true},{"name":"syncing","value":"Syncing..."},{"name":"sync_button_clicked","value":false,"exclude_from_translation":true},{"name":"copy","value":"Copy code"},{"name":"copied","value":"Copied!"},{"type":"begin_display_group","name":"has_ever_been_synced","condition":"@local.sync_latest","parameter_list":"style: column"},{"type":"qr_code","value":"@local.user_id"},{"type":"select_text","name":"user_code","value":"@local.user_id","parameter_list":"copy_text: @local.copy;\ncopied_text: @local.copied"},{"type":"text","name":"last_sync_text","value":"Last sync at: @local.sync_latest"},{"type":"end_display_group"},{"type":"begin_display_group","name":"has_never_been_synced","condition":"!@local.sync_latest","parameter_list":"style: column"},{"type":"text","name":"not_synced_text","value":"This device has never been synced. Sync to reveal your code."},{"type":"end_display_group"},{"type":"button","name":"sync_button","value":"Sync now","action_list":"click | set_local: sync_status: @local.syncing;\nclick | set_local: sync_status: @local.syncing;\nclick | emit: force_reprocess;\nclick | emit: server_sync;\nclick | set_local: sync_status: ;\nclick | set_local: sync_button_clicked: true;\nclick | emit: force_reprocess;","condition":"!@local.sync_status"},{"type":"button","name":"sync_button_disabled","value":"@local.syncing","condition":"@local.sync_status","parameter_list":"disabled:true"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"profile_group","status":"released","rows":[{"type":"update_action_list","name":"custom_actions_1","action_list":"nav_resume | emit: force_reload"},{"type":"begin_template","name":"header","value":"section_header"},{"name":"section_id","value":"group","exclude_from_translation":true},{"name":"section_data","value":"profile_section"},{"type":"end_template"},{"type":"begin_template","name":"parent_group","value":"parent_group"},{"name":"group_no","value":1},{"type":"end_template"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"profile_groups","status":"released","rows":[{"type":"begin_template","name":"header","value":"section_header"},{"name":"section_id","value":"groups","exclude_from_translation":true},{"name":"section_data","value":"profile_section"},{"type":"end_template"},{"name":"no_of_parent_groups","value":"+@fields.no_of_parent_groups"},{"type":"begin_items","value":"@data.number"},{"type":"begin_display_group","name":"dg_group_@item.id","parameter_list":"style: dashed_box","condition":"@item.id <= @local.no_of_parent_groups"},{"type":"text","name":"text_group","value":"Group @item.id","parameter_list":"style: emphasised"},{"type":"begin_template","name":"parent_group","value":"parent_group"},{"name":"group_no","value":"@item.id"},{"type":"end_template"},{"type":"end_display_group"},{"type":"end_items"},{"type":"button","name":"add_group","value":"Add a new group","action_list":"click | set_field: no_of_parent_groups: @local.no_of_parent_groups + 1; \nclick | set_local: no_of_parent_groups: @local.no_of_parent_groups + 1;","parameter_list":"style: card"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"parent_group","status":"released","rows":[{"name":"group_no","value":1},{"name":"parent_data_json","value":"@calc(JSON.parse(@fields.parent_data))","exclude_from_translation":true},{"name":"parent","value":"Parent"},{"type":"begin_items","value":"@local.parent_data_json","exclude_from_translation":true},{"name":"parent_no","value":"@item.parent_no","exclude_from_translation":true},{"name":"parent_id","value":"parent_@local.parent_no","exclude_from_translation":true},{"name":"parent_first_name","value":"@local.parent_data_json[@local.parent_id].first_name","exclude_from_translation":true},{"name":"parent_last_name","value":"@local.parent_data_json[@local.parent_id].last_name","exclude_from_translation":true},{"name":"parent_name","value":"@calc((@local.parent_first_name || @local.parent_last_name) ? `${@local.parent_first_name || ''} ${@local.parent_last_name || ''}`.trim() : `${@local.parent} ${@local.parent_no}`)","exclude_from_translation":true},{"type":"begin_display_group","name":"dg_parent_@item.parent_no"},{"type":"text","name":"text_@item.parent_no","value":"@local.parent_name","style_list":"flex: 1","exclude_from_translation":true},{"type":"round_button","name":"button_edit_@item.parent_no","action_list":"click | set_field: current_parent_no: @local.parent_no; \nclick | go_to: parent_profile;","parameter_list":"icon_src: pencil; style: navigation","exclude_from_translation":true},{"type":"round_button","name":"button_delete_@item.parent_no","action_list":"click | set_field: current_parent_no: @local.parent_no; \nclick | pop_up: delete_parent;","parameter_list":"icon_src: trash; style: navigation","exclude_from_translation":true},{"type":"end_display_group"},{"type":"end_items"},{"type":"button","name":"add_parent","value":"Add a new parent","action_list":"click | set_field: current_parent_group_no: @local.group_no; \nclick | set_field: current_parent_no: @fields.first_unused_parent_no; \nclick | set_field: first_unused_parent_no: +@fields.first_unused_parent_no + 1;\nclick | go_to: parent_profile; ","parameter_list":"style: card"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"delete_parent","status":"released","rows":[{"name":"parent_no","value":"@fields.current_parent_no","exclude_from_translation":true},{"name":"parent_id","value":"parent_@local.parent_no","exclude_from_translation":true},{"name":"parent","value":"Parent"},{"name":"parent_data_json","value":"@calc(JSON.parse(@fields.parent_data))","exclude_from_translation":true},{"name":"archived_parent_data_json","value":"@calc(JSON.parse(@fields.archived_parent_data))","exclude_from_translation":true},{"name":"parent_first_name","value":"@local.parent_data_json[@local.parent_id].first_name","exclude_from_translation":true},{"name":"parent_last_name","value":"@local.parent_data_json[@local.parent_id].last_name","exclude_from_translation":true},{"name":"parent_name","value":"@calc((@local.parent_first_name || @local.parent_last_name) ? `${@local.parent_first_name || ''} ${@local.parent_last_name || ''}`.trim() : `${@local.parent} ${@local.parent_no}`)","exclude_from_translation":true},{"type":"title","name":"title","value":"Delete parent"},{"type":"text","name":"text_warning","value":"Are you sure you want to delete @local.parent_name? This cannot be undone."},{"name":"show_buttons","value":true,"exclude_from_translation":true},{"name":"archive_this_parent","value":"@calc(@local.archived_parent_data_json[@local.parent_id] = @local.parent_data_json[@local.parent_id])","exclude_from_translation":true},{"name":"archived_parent_data_string","value":"@calc(JSON.stringify(@local.archived_parent_data_json))","exclude_from_translation":true},{"name":"delete_this_parent","value":"@calc(delete @local.parent_data_json[@local.parent_id])","exclude_from_translation":true},{"name":"parent_data_string","value":"@calc(JSON.stringify(@local.parent_data_json))","exclude_from_translation":true},{"name":"family_data_json","value":"@calc(JSON.parse(@fields.family_data))","exclude_from_translation":true},{"name":"remove_family_member","value":"@calc(plh_remove_family_member(@local.family_data_json, @local.parent_id))","exclude_from_translation":true},{"name":"debug_family_data_updated","value":"@calc(JSON.stringify(@local.remove_family_member))","exclude_from_translation":true},{"type":"begin_display_group","name":"buttons"},{"type":"button","name":"button_no","value":"No","action_list":"click | emit: uncompleted","parameter_list":"style: card","style_list":"flex:1"},{"type":"button","name":"button_delete","value":"Yes","action_list":"click | set_field: parent_data: @local.parent_data_string; \nclick | set_field: family_data: @local.remove_family_member; \nclick | set_field: archived_parent_data: @local.archived_parent_data_string; \nclick | emit: completed;","parameter_list":"style: card","style_list":"flex:1"},{"type":"end_display_group"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"parent_profile","status":"released","rows":[{"type":"update_action_list","name":"custom_actions_1","action_list":"nav_resume | emit: force_reload"},{"type":"title","name":"title","value":"Parent profile"},{"name":"validate_external_id","value":true,"exclude_from_translation":true},{"name":"parent_no","value":"@fields.current_parent_no","exclude_from_translation":true},{"name":"parent_id","value":"parent_@fields.current_parent_no","exclude_from_translation":true},{"name":"parent_data_json","value":"@calc(JSON.parse(@fields.parent_data))","exclude_from_translation":true},{"name":"family_data_json","value":"@calc(JSON.parse(@fields.family_data))","condition":"!@local.new_profile","exclude_from_translation":true},{"name":"previous_parent_id_array","value":"@calc(Object.keys(@local.parent_data_json))","exclude_from_translation":true},{"name":"new_profile","value":"@calc(!(@local.previous_parent_id_array.includes(@local.parent_id)))","exclude_from_translation":true},{"name":"add_new_parent","value":"@calc(@local.parent_data_json[@local.parent_id] = {})","condition":"@local.new_profile","comments":"If this is a new parent profile:\nAdd an entry to the parent data json for this parent and...","exclude_from_translation":true},{"name":"set_new_parent_no","value":"@calc(@local.parent_data_json[@local.parent_id].parent_no = @local.parent_no)","condition":"@local.new_profile","comments":"... set their parent number and","exclude_from_translation":true},{"name":"set_new_parent_group_no","value":"@calc(@local.parent_data_json[@local.parent_id].parent_group_no = @fields.current_parent_group_no)","condition":"@local.new_profile","comments":"... set their parent group number","exclude_from_translation":true},{"name":"family_data_json_before","value":"@calc(JSON.parse(@fields.family_data))","condition":"@local.new_profile","exclude_from_translation":true},{"name":"family_data_json","value":"@calc(plh_add_family(@local.family_data_json_before, @local.parent_id))","condition":"@local.new_profile","comments":"... add them to family data json","exclude_from_translation":true},{"type":"text","name":"text_first_name","value":"First name","parameter_list":"style: emphasised"},{"name":"first_name","value":"@local.parent_data_json[@local.parent_id].first_name","exclude_from_translation":true},{"type":"text_box","name":"text_box_first_name","value":"@local.first_name","exclude_from_translation":true},{"name":"set_first_name","value":"@calc(@local.parent_data_json[@local.parent_id].first_name = @local.text_box_first_name)","exclude_from_translation":true},{"type":"text","name":"text_last_name","value":"Last name","parameter_list":"style: emphasised"},{"name":"last_name","value":"@local.parent_data_json[@local.parent_id].last_name","exclude_from_translation":true},{"type":"text_box","name":"text_box_last_name","value":"@local.last_name","exclude_from_translation":true},{"name":"set_last_name","value":"@calc(@local.parent_data_json[@local.parent_id].last_name = @local.text_box_last_name)","exclude_from_translation":true},{"type":"text","name":"text_external_id","value":"ParentText ID","parameter_list":"style: emphasised"},{"name":"external_id","value":"@local.parent_data_json[@local.parent_id].external_id","exclude_from_translation":true},{"type":"text_box","name":"text_box_external_id","value":"@local.external_id","exclude_from_translation":true},{"type":"begin_display_group","name":"dg_validate_external_id","parameter_list":"style: column","condition":"@local.validate_external_id"},{"name":"external_id_valid_syntax","value":"@calc(/^\\d{6}$/.test(@local.text_box_external_id))","exclude_from_translation":true},{"type":"text","name":"warning_external_id_invalid_syntax","value":"Make sure that the ParentText ID consists of 6 numerical characters.","condition":"!@local.external_id_valid_syntax && !!(@local.text_box_external_id)"},{"name":"other_external_ids_array","value":"@calc(Object.values(@local.parent_data_json).filter(item => item.parent_no != @local.parent_no).map(item => item.external_id))","exclude_from_translation":true},{"name":"external_id_already_in_use","value":"@calc(@local.other_external_ids_array.includes(@local.text_box_external_id))","exclude_from_translation":true},{"type":"text","name":"warning_external_id_in_use","value":"This ParentText ID has already been assigned to another parent.","condition":"@local.external_id_already_in_use && !!(@local.text_box_external_id)"},{"name":"external_id_accepted","value":"@local.external_id_valid_syntax && !@local.external_id_already_in_use","exclude_from_translation":true},{"type":"end_display_group","exclude_from_translation":true},{"name":"set_external_id","value":"@calc(@local.parent_data_json[@local.parent_id].external_id = @local.text_box_external_id)","exclude_from_translation":true},{"type":"begin_display_group","name":"dg_when_external_id_accepted","parameter_list":"style: column","condition":"@local.external_id_accepted || !@local.validate_external_id"},{"type":"begin_display_group","name":"dg_add"},{"type":"text","name":"text_coparent","value":"Co-parenting with","parameter_list":"style: emphasised","style_list":"flex: 1"},{"name":"parent_data_up_to_coparents_string","value":"@calc(JSON.stringify(@local.parent_data_json))","exclude_from_translation":true},{"name":"family_data_up_to_coparents_string","value":"@calc(JSON.stringify(@local.family_data_json))","exclude_from_translation":true},{"type":"round_button","name":"button_add","action_list":"click | set_field: parent_data: @local.parent_data_up_to_coparents_string; \nclick | set_field: family_data: @local.family_data_up_to_coparents_string; \nclick | pop_up: add_coparent;","parameter_list":"icon_src: person-add; style: navigation;","exclude_from_translation":true},{"type":"end_display_group","exclude_from_translation":true},{"name":"this_family_array","value":"@calc(@local.family_data_json.find((arr) => arr.includes(@local.parent_id)))","exclude_from_translation":true},{"name":"parent","value":"Parent"},{"type":"begin_items","value":"@local.parent_data_json","condition":"!@local.new_profile","exclude_from_translation":true},{"name":"coparent_no","value":"@item.parent_no","exclude_from_translation":true},{"name":"coparent_id","value":"parent_@item.parent_no","exclude_from_translation":true},{"name":"is_family_member","value":"@calc(@local.this_family_array.includes(@local.coparent_id))","exclude_from_translation":true},{"type":"begin_display_group","name":"dg_coparent_@item.parent_no","condition":"@local.is_family_member && @local.parent_no != @item.parent_no"},{"name":"coparent_first_name","value":"@local.parent_data_json[@local.coparent_id].first_name","exclude_from_translation":true},{"name":"coparent_last_name","value":"@local.parent_data_json[@local.coparent_id].last_name","exclude_from_translation":true},{"name":"coparent_name","value":"@calc((@local.coparent_first_name || @local.coparent_last_name) ? `${@local.coparent_first_name || ''} ${@local.coparent_last_name || ''}`.trim() : `${@local.parent} ${@local.coparent_no}`)","exclude_from_translation":true},{"type":"text","name":"text_name_@item.parent_no","value":"@local.coparent_name","style_list":"flex: 1","exclude_from_translation":true},{"name":"remove_family_member","value":"@calc(plh_remove_family_member(@local.family_data_json, @local.coparent_id))","exclude_from_translation":true},{"name":"add_singleton_family","value":"@calc(plh_add_family(@local.remove_family_member, @local.coparent_id))","exclude_from_translation":true},{"name":"uncoupled_coparent_family_data_string","value":"@calc(JSON.stringify(@local.add_singleton_family))","exclude_from_translation":true},{"type":"round_button","name":"button_remove","action_list":"click | set_field: family_data: @local.uncoupled_coparent_family_data_string; click | emit: force_reprocess","parameter_list":"icon_src: person-remove; style: navigation","exclude_from_translation":true},{"type":"end_display_group","exclude_from_translation":true},{"type":"end_items","exclude_from_translation":true},{"name":"family_data_string","value":"@calc(JSON.stringify(@local.family_data_json))","exclude_from_translation":true},{"name":"parent_data_string","value":"@calc(JSON.stringify(@local.parent_data_json))","exclude_from_translation":true},{"type":"begin_template","name":"nav_buttons","value":"nav_buttons","action_list":"completed | set_field: parent_data: @local.parent_data_string; \ncompleted | set_field: family_data: @local.family_data_string; \ncompleted | emit: server_sync; \ncompleted | emit: completed","exclude_from_translation":true},{"name":"button_completed"},{"type":"end_template"},{"type":"end_display_group"}],"_xlsxPath":"templates/profile.xlsx"},{"flow_type":"template","flow_name":"add_coparent","status":"released","rows":[{"type":"title","name":"title","value":"Select co-parent from existing parents"},{"name":"parent_data_json","value":"@calc(JSON.parse(@fields.parent_data))","exclude_from_translation":true},{"name":"family_data_json","value":"@calc(JSON.parse(@fields.family_data))","exclude_from_translation":true},{"name":"parent_no","value":"@fields.current_parent_no","exclude_from_translation":true},{"name":"parent_id","value":"parent_@fields.current_parent_no","exclude_from_translation":true},{"name":"parent","value":"Parent"},{"name":"this_family_array","value":"@calc(@local.family_data_json.find((arr) => arr.includes(@local.parent_id)))","exclude_from_translation":true},{"type":"begin_items","value":"@local.parent_data_json","exclude_from_translation":true},{"name":"coparent_no","value":"@item.parent_no","exclude_from_translation":true},{"name":"coparent_id","value":"parent_@item.parent_no","exclude_from_translation":true},{"name":"already_part_of_this_family","value":"@calc(@local.this_family_array.includes(@local.coparent_id))","exclude_from_translation":true},{"type":"begin_display_group","name":"dg_parent_@item.parent_no","condition":"!@local.already_part_of_this_family","exclude_from_translation":true},{"name":"coparent_first_name","value":"@local.parent_data_json[@local.coparent_id].first_name","exclude_from_translation":true},{"name":"coparent_last_name","value":"@local.parent_data_json[@local.coparent_id].last_name","exclude_from_translation":true},{"name":"coparent_name","value":"@calc((@local.coparent_first_name || @local.coparent_last_name) ? `${@local.coparent_first_name || ''} ${@local.coparent_last_name || ''}`.trim() : `${@local.parent} ${@local.coparent_no}`)","exclude_from_translation":true},{"name":"merge_families","value":"@calc(plh_merge_families(@local.family_data_json, @local.parent_id, @local.coparent_id))","exclude_from_translation":true},{"name":"family_data_string","value":"@calc(JSON.stringify(@local.merge_families))","exclude_from_translation":true},{"type":"button","name":"button_@item.parent_no","value":"@local.coparent_name","action_list":"click | set_field: family_data: @local.family_data_string; \nclick | emit: completed","parameter_list":"style: card","style_list":"flex: 1","exclude_from_translation":true},{"type":"end_display_group"},{"type":"end_items"}],"_xlsxPath":"templates/profile.xlsx"}]
